<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Build recommender systems and make predictions | STATS5099 Data Mining and Machine Learning</title>
  <meta name="description" content="4 Build recommender systems and make predictions | STATS5099 Data Mining and Machine Learning" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Build recommender systems and make predictions | STATS5099 Data Mining and Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Build recommender systems and make predictions | STATS5099 Data Mining and Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exploratory-data-analysis.html"/>
<link rel="next" href="evaluate-recommender-systems-using-built-in-functions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to DMML Lab 10</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#build-recommender-systems-and-make-predictions"><i class="fa fa-check"></i><b>1.1</b> Build recommender systems and make predictions</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#evaluate-recommender-systems"><i class="fa fa-check"></i><b>1.2</b> Evaluate recommender systems</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-1-jester5k.html"><a href="example-1-jester5k.html"><i class="fa fa-check"></i><b>2</b> Example 1: Jester5k</a></li>
<li class="chapter" data-level="3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>3</b> Exploratory data analysis</a></li>
<li class="chapter" data-level="4" data-path="build-recommender-systems-and-make-predictions-1.html"><a href="build-recommender-systems-and-make-predictions-1.html"><i class="fa fa-check"></i><b>4</b> Build recommender systems and make predictions</a></li>
<li class="chapter" data-level="5" data-path="evaluate-recommender-systems-using-built-in-functions.html"><a href="evaluate-recommender-systems-using-built-in-functions.html"><i class="fa fa-check"></i><b>5</b> Evaluate recommender systems using built-in functions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="evaluate-recommender-systems-using-built-in-functions.html"><a href="evaluate-recommender-systems-using-built-in-functions.html#evaluate-predicted-ratings"><i class="fa fa-check"></i><b>5.1</b> Evaluate predicted ratings</a></li>
<li class="chapter" data-level="5.2" data-path="evaluate-recommender-systems-using-built-in-functions.html"><a href="evaluate-recommender-systems-using-built-in-functions.html#evaluate-top-n-recommendations"><i class="fa fa-check"></i><b>5.2</b> Evaluate top-N recommendations</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STATS5099 Data Mining and Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="build-recommender-systems-and-make-predictions-1" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Build recommender systems and make predictions<a href="build-recommender-systems-and-make-predictions-1.html#build-recommender-systems-and-make-predictions-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>First, let's build a user-based collaborative filtering (UBCF) system to predict the ratings and the top-<span class="math inline">\(N\)</span> recommendations. Here, we use Pearson correlation to measure the similarity between users and select the nearest five users to form a neighbourhood.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="build-recommender-systems-and-make-predictions-1.html#cb17-1" tabindex="-1"></a>Jester_UBCF <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(Jester5k, <span class="at">method=</span><span class="st">&quot;UBCF&quot;</span>,</span>
<span id="cb17-2"><a href="build-recommender-systems-and-make-predictions-1.html#cb17-2" tabindex="-1"></a>                           <span class="at">param=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">&quot;pearson&quot;</span>,<span class="at">nn=</span><span class="dv">5</span>))</span>
<span id="cb17-3"><a href="build-recommender-systems-and-make-predictions-1.html#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="build-recommender-systems-and-make-predictions-1.html#cb17-4" tabindex="-1"></a><span class="co"># Predict ratings only for unrated items</span></span>
<span id="cb17-5"><a href="build-recommender-systems-and-make-predictions-1.html#cb17-5" tabindex="-1"></a>Jester_UBCF_rating <span class="ot">&lt;-</span> <span class="fu">predict</span>(Jester_UBCF, Jester5k, <span class="at">type=</span><span class="st">&quot;ratings&quot;</span>)</span>
<span id="cb17-6"><a href="build-recommender-systems-and-make-predictions-1.html#cb17-6" tabindex="-1"></a>Jester_UBCF_rating<span class="sc">@</span>data[<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] </span></code></pre></div>
<pre><code>## 6 x 10 sparse Matrix of class &quot;dgCMatrix&quot;
##                                                                            
## u23653  .            .          .        .        . .        . .   .       
## u9196  -0.07931507 -11.389315 -11.09932 -8.529315 . 1.979581 . . -11.969315
## u623    .            .          .        .        . .        . .   .       
## u15241 -6.58902953  -9.318072 -10.24682 -7.785684 . .        . .  -5.911201
## u10885  .            .          .        .        . .        . .   .       
## u934    .            .          .        .        . .        . .   .       
##                
## u23653 .       
## u9196  2.338837
## u623   .       
## u15241 .       
## u10885 .       
## u934   .</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="build-recommender-systems-and-make-predictions-1.html#cb19-1" tabindex="-1"></a><span class="co"># Predict ratings for all items </span></span>
<span id="cb19-2"><a href="build-recommender-systems-and-make-predictions-1.html#cb19-2" tabindex="-1"></a>Jester_UBCF_ratMat <span class="ot">&lt;-</span> <span class="fu">predict</span>(Jester_UBCF, Jester5k, <span class="at">type=</span><span class="st">&quot;ratingMatrix&quot;</span>)</span>
<span id="cb19-3"><a href="build-recommender-systems-and-make-predictions-1.html#cb19-3" tabindex="-1"></a>Jester_UBCF_ratMat<span class="sc">@</span>data[<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] </span></code></pre></div>
<pre><code>## 6 x 10 sparse Matrix of class &quot;dgCMatrix&quot;
##                                                                        
## u23653  4.47000000   6.500162   8.20000  6.890000   4.4607620  6.249957
## u9196  -0.07931507 -11.389315 -11.09932 -8.529315  -0.9528821  1.979581
## u623    2.82000000   8.443053  -3.25000 -4.900000   0.5686730  8.790000
## u15241 -6.58902953  -9.318072 -10.24682 -7.785684 -10.9454347 -8.377496
## u10885  7.23000000   2.140000   3.11000  0.830000   4.7309487  5.455884
## u934    2.28000000   5.050000   3.25000 -4.030000  -2.5496590 -1.410000
##                                                  
## u23653  5.6891707  3.2277391  -7.860000  1.682018
## u9196   0.9858209  2.6325211 -11.969315  2.338837
## u623   -1.3240298 -2.2544086  -2.280000  0.190000
## u15241 -6.2988748 -6.6407474  -5.911201 -7.945736
## u10885 -4.5946605  2.0570513   3.300000  3.365357
## u934   -5.2687146  0.0676189  -2.620000  3.395148</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="build-recommender-systems-and-make-predictions-1.html#cb21-1" tabindex="-1"></a><span class="co"># Recommend top-3 items.</span></span>
<span id="cb21-2"><a href="build-recommender-systems-and-make-predictions-1.html#cb21-2" tabindex="-1"></a>Jester_UBCF_topN <span class="ot">&lt;-</span> <span class="fu">predict</span>(Jester_UBCF, Jester5k, <span class="at">type=</span><span class="st">&quot;topNList&quot;</span>, <span class="at">n=</span><span class="dv">3</span>)</span>
<span id="cb21-3"><a href="build-recommender-systems-and-make-predictions-1.html#cb21-3" tabindex="-1"></a><span class="fu">getList</span>(Jester_UBCF_topN)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## $`0`
## character(0)
## 
## $`1`
## character(0)
## 
## $`2`
## [1] &quot;j88&quot; &quot;j86&quot; &quot;j72&quot;
## 
## $`3`
## [1] &quot;j93&quot; &quot;j76&quot; &quot;j86&quot;
## 
## $`4`
## character(0)</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="build-recommender-systems-and-make-predictions-1.html#cb23-1" tabindex="-1"></a><span class="co"># some users have rated all items and thus the prediction returns &quot;character(0)&quot;</span></span></code></pre></div>
<p>Let's now move on to an item-based collaborative filtering (IBCF) system.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="build-recommender-systems-and-make-predictions-1.html#cb24-1" tabindex="-1"></a>Jester_IBCF <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(Jester5k, <span class="at">method=</span><span class="st">&quot;IBCF&quot;</span>,</span>
<span id="cb24-2"><a href="build-recommender-systems-and-make-predictions-1.html#cb24-2" tabindex="-1"></a>                           <span class="at">param=</span><span class="fu">list</span>(<span class="at">k=</span><span class="dv">20</span>)) <span class="co">#k: no. similar items</span></span></code></pre></div>
<p>You can revise the previous codes on the UBCF system to predict ratings and top-<span class="math inline">\(N\)</span> items with the new IBCF system.
Finally, we can perform UV-decomposition on the rating matrix. Strictly speaking, the package implements the idea of matrix factorization using singular value decomposition (SVD), which is numerically more robust and efficient. The key parameter for matrix decomposition (either UV or SVD) is the latent dimension, which is set as 3 in the following code.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="build-recommender-systems-and-make-predictions-1.html#cb25-1" tabindex="-1"></a>Jester_UV <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(Jester5k,<span class="at">method=</span><span class="st">&quot;SVDF&quot;</span>,</span>
<span id="cb25-2"><a href="build-recommender-systems-and-make-predictions-1.html#cb25-2" tabindex="-1"></a>                         <span class="at">param=</span><span class="fu">list</span>(<span class="at">k=</span><span class="dv">3</span>)) <span class="co">#k: latent dimension</span></span>
<span id="cb25-3"><a href="build-recommender-systems-and-make-predictions-1.html#cb25-3" tabindex="-1"></a><span class="fu">dim</span>(Jester_UV<span class="sc">@</span>model<span class="sc">$</span>svd<span class="sc">$</span>U)</span></code></pre></div>
<pre><code>## [1] 5000    3</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="build-recommender-systems-and-make-predictions-1.html#cb27-1" tabindex="-1"></a><span class="fu">dim</span>(Jester_UV<span class="sc">@</span>model<span class="sc">$</span>svd<span class="sc">$</span>V)</span></code></pre></div>
<pre><code>## [1] 100   3</code></pre>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="exploratory-data-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="evaluate-recommender-systems-using-built-in-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["main.pdf", "main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
